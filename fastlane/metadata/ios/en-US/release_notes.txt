Bug fixes, plus preparations for some bigger changes in the future
